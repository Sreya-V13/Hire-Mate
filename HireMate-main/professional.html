<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HireMate - Professional Dashboard</title>
    <link rel="stylesheet" href="professional-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbG3ORlU0Esa6bHYOrVT85HLkCmfRAcp0"></script>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo">
            <img src="hiremate-logo.jpg" alt="HireMate Logo" class="logo-img">
            <span class="logo-text">HireMate</span>
        </div>
        <div class="nav-links">
            <a href="#"><i class="fas fa-home"></i> Home</a>
            <a href="#services"><i class="fas fa-briefcase"></i> My Services</a>
            <a href="#bookings"><i class="fas fa-calendar-check"></i> Bookings</a>
            <a href="#earnings"><i class="fas fa-wallet"></i> Earnings</a>
            <a href="#"><i class="fas fa-bell"></i> Notifications</a>
            <a href="#" id="profileBtn"><i class="fas fa-user"></i> Profile</a>
            <a href="#" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1><i class="fas fa-user-circle"></i> Welcome, Professional</h1>
            <button class="cta-button" onclick="manageServices()">
                <i class="fas fa-plus-circle"></i> Manage Services
            </button>
            <div class="key-stats">
                <div class="stat">
                    <i class="fas fa-rupee-sign fa-2x"></i>
                    <h3>Total Earnings</h3>
                    <p>₹25,000</p>
                </div>
                <div class="stat">
                    <i class="fas fa-calendar-check fa-2x"></i>
                    <h3>Active Bookings</h3>
                    <p>12</p>
                </div>
                <div class="stat">
                    <i class="fas fa-star fa-2x"></i>
                    <h3>Rating</h3>
                    <p>4.8/5</p>
                </div>
            </div>
        </div>
    </section>

    <!-- My Services Section -->
    <section class="my-services">
        <div class="container">
            <h2><i class="fas fa-briefcase"></i> My Services</h2>
            <button class="add-service-btn" onclick="openServiceModal()">
                <i class="fas fa-plus-circle"></i> Add New Service
            </button>
            
            <!-- Service Categories and Listings -->
            <div class="services-list">
                <!-- Service items will be populated here -->
            </div>
        </div>

        <!-- Add Service Modal -->
        <div id="serviceModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeServiceModal()">&times;</span>
                <h2>Add New Service</h2>
                <form id="addServiceForm" onsubmit="handleAddService(event)">
                    <div class="form-group">
                        <label for="serviceCategory">Category:</label>
                        <select id="serviceCategory" required onchange="updateServiceOptions()">
                            <option value="">Select Category</option>
                            <option value="Technology">Technology</option>
                            <option value="Home Services">Home Services</option>
                            <option value="Education">Education</option>
                            <option value="Body & Hair Care">Body & Hair Care</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="serviceType">Service Type:</label>
                        <select id="serviceType" required>
                            <option value="">Select Service Type</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="servicePrice">Price (per hour/service):</label>
                        <input type="number" id="servicePrice" required min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="serviceDescription">Description:</label>
                        <textarea id="serviceDescription" required></textarea>
                </div>

                    <button type="submit" class="submit-btn">Add Service</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Bookings Section -->
    <section class="bookings">
        <div class="container">
            <h2><i class="fas fa-calendar-check"></i> Bookings</h2>
            <div class="upcoming-bookings">
                <h3>Upcoming Bookings</h3>
                <div class="booking-item">
                    <div class="booking-info">
                        <div class="client-info">
                            <i class="fas fa-user-circle"></i>
                            <p>Client: Arjun Singh</p>
                        </div>
                        <div class="booking-details">
                            <p><i class="fas fa-calendar"></i> Date: March 20, 2024</p>
                            <p><i class="fas fa-clock"></i> Time: 10:00 AM</p>
                            <p><i class="fas fa-rupee-sign"></i> Amount: ₹2,500</p>
                            <p><i class="fas fa-info-circle"></i> Status: Pending</p>
                            <p><i class="fas fa-map-marker-alt"></i> Location: Andheri West, Mumbai</p>
                        </div>
                    </div>
                    <div class="booking-actions">
                        <button class="accept-btn">
                            <i class="fas fa-check"></i> Accept
                        </button>
                        <button class="cancel-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            <div class="past-bookings">
                <h3>Past Bookings</h3>
                <div class="booking-item">
                    <div class="booking-info">
                        <div class="client-info">
                            <i class="fas fa-user-circle"></i>
                    <p>Client Name: [Client Name]</p>
                        </div>
                        <div class="booking-details">
                            <p><i class="fas fa-calendar"></i> Date: [Date]</p>
                            <p><i class="fas fa-clock"></i> Time: [Time]</p>
                            <p><i class="fas fa-check-circle"></i> Status: Completed</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="map-container">
                <div id="bookingMap" class="booking-map"></div>
                <button class="directions-btn" onclick="getDirections()">Get Directions</button>
            </div>
        </div>
    </section>

    <!-- Earnings & Payments Section -->
    <section class="earnings">
        <div class="container">
            <h2><i class="fas fa-wallet"></i> Earnings & Payments</h2>
            <div class="earnings-dashboard">
                <h3>Total Earnings</h3>
                <p>₹25,000</p>
                <button class="withdraw-btn">
                    <i class="fas fa-money-bill-wave"></i> Withdraw Funds
                </button>
            </div>
            <div class="transaction-history">
                <h3>Transaction History</h3>
                <div class="transaction-item">
                    <p><i class="fas fa-calendar"></i> March 15, 2024</p>
                    <p><i class="fas fa-rupee-sign"></i> ₹1,500.00</p>
                    <p class="transaction-status status-completed">Completed</p>
                </div>
                <div class="transaction-item">
                    <p><i class="fas fa-calendar"></i> March 14, 2024</p>
                    <p><i class="fas fa-rupee-sign"></i> ₹850.00</p>
                    <p class="transaction-status status-completed">Completed</p>
                </div>
                <div class="transaction-item">
                    <p><i class="fas fa-calendar"></i> March 13, 2024</p>
                    <p><i class="fas fa-rupee-sign"></i> ₹2,000.00</p>
                    <p class="transaction-status status-pending">Pending</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Customer Reviews & Ratings Section -->
    <section class="reviews">
        <div class="container">
            <h2><i class="fas fa-star"></i> Customer Reviews & Ratings</h2>
            <div class="review-item">
                <div class="review-header">
                    <img src="https://randomuser.me/api/portraits/women/45.jpg" alt="Anjali M." class="reviewer-avatar">
                    <div class="review-info">
                        <h4>Anjali Mehta</h4>
                        <div class="review-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p class="review-date">March 15, 2024</p>
                    </div>
                </div>
                <p class="review-content">Excellent service! Very professional and thorough with their work. Would definitely recommend to others.</p>
                <button class="reply-btn">
                    <i class="fas fa-reply"></i> Reply
                </button>
            </div>

            <div class="review-item">
                <div class="review-header">
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Rahul D." class="reviewer-avatar">
                    <div class="review-info">
                        <h4>Rahul Desai</h4>
                        <div class="review-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <p class="review-date">March 13, 2024</p>
                    </div>
                </div>
                <p class="review-content">Great work overall. Arrived on time and completed the job efficiently.</p>
                <button class="reply-btn">
                    <i class="fas fa-reply"></i> Reply
                </button>
            </div>

            <div class="review-item">
                <div class="review-header">
                    <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="Priya W." class="reviewer-avatar">
                    <div class="review-info">
                        <h4>Priya Walia</h4>
                        <div class="review-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="review-date">March 10, 2024</p>
                    </div>
                </div>
                <p class="review-content">Very satisfied with the quality of work. The attention to detail was impressive.</p>
                <button class="reply-btn">
                    <i class="fas fa-reply"></i> Reply
                </button>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Support</h3>
                <p><i class="fas fa-envelope"></i> support@hiremate.com</p>
                <p><i class="fas fa-phone"></i> +91 (555) 123-4567</p>
            </div>
            <div class="footer-section">
                <h3>Terms & Conditions</h3>
                <p><a href="#">Read our terms and conditions</a></p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 HireMate. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add this modal at the end of the body -->
    <div id="bookingSummaryModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBookingSummaryModal()">&times;</span>
            <h2>Booking Summary</h2>
            <div id="bookingSummaryDetails"></div>
        </div>
    </div>

    <script>
        // Toggle profile dropdown
        function toggleProfileDropdown() {
            const profileDropdown = document.getElementById('profileDropdown');
            profileDropdown.classList.toggle('show');
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userType');
            localStorage.removeItem('professionalId');
            localStorage.removeItem('userName');
            window.location.href = 'login.html';
        }

        // Manage services
        function manageServices() {
            // Logic to manage services
        }

        // Add new service
        function addService() {
            // Logic to add new service
        }

        // Close profile dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.profile-btn')) {
                const dropdowns = document.getElementsByClassName('dropdown-content');
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        // Add authentication check
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userType = localStorage.getItem('userType');
            
            if (!isLoggedIn || userType !== 'professional') {
                window.location.href = 'login.html?type=professional';
                return;
            }
            
            // Display professional name
            const userName = localStorage.getItem('userName');
            if (userName) {
                // Update the professional name in the dashboard
                const welcomeText = userName === 'professional@gmail.com' ? 
                    'Welcome, Professional User' : `Welcome, ${userName}`;
                document.querySelector('.hero h1').textContent = welcomeText;
            }

            // Update monetary values
            document.querySelectorAll('.stat p, .earnings-dashboard p, .transaction-item p').forEach(element => {
                const text = element.textContent;
                if (text.includes('₹')) {
                    const amount = text.replace(/[₹,]/g, '');
                    if (!isNaN(amount)) {
                        element.textContent = formatIndianPrice(amount);
                    }
                }
            });

            // Initialize the map
            initMap();
        });

        let map;
        let marker;

        function initMap() {
            // Example coordinates (you would get these from your booking data)
            const location = { lat: -34.397, lng: 150.644 };

            // Create map
            map = new google.maps.Map(document.getElementById('bookingMap'), {
                center: location,
                zoom: 15,
                styles: [
                    {
                        "featureType": "all",
                        "elementType": "geometry",
                        "stylers": [{ "color": "#f5f5f5" }]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [{ "color": "#e9e9e9" }]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels.text.fill",
                        "stylers": [{ "color": "#9e9e9e" }]
                    }
                ]
            });

            // Add marker
            marker = new google.maps.Marker({
                position: location,
                map: map,
                title: 'Booking Location',
                animation: google.maps.Animation.DROP
            });

            // Add click listener to location text
            document.querySelector('.location-text').addEventListener('click', function() {
                map.setCenter(marker.getPosition());
                marker.setAnimation(google.maps.Animation.BOUNCE);
                setTimeout(() => marker.setAnimation(null), 1500);
            });
        }

        function getDirections() {
            // Get the marker position
            const destination = marker.getPosition();
            
            // Open Google Maps in a new tab with directions
            window.open(
                `https://www.google.com/maps/dir/?api=1&destination=${destination.lat()},${destination.lng()}`,
                '_blank'
            );
        }

        // Update map location when booking location changes
        function updateMapLocation(lat, lng, address) {
            const location = { lat: lat, lng: lng };
            map.setCenter(location);
            marker.setPosition(location);
            document.querySelector('.location-text').textContent = address;
        }

        // Service categories and their corresponding services
        const serviceCategories = {
            'Technology': [
                { name: 'Computer Repair', price: '₹1500/hr', icon: 'fa-laptop', description: 'Professional computer repair and maintenance services' },
                { name: 'IT Consulting', price: '₹2000/hr', icon: 'fa-tasks', description: 'Expert IT consultation and solutions' },
                { name: 'Web Development', price: '₹2500/hr', icon: 'fa-code', description: 'Custom website development and maintenance' },
                { name: 'Network Setup', price: '₹2000/hr', icon: 'fa-network-wired', description: 'Professional network installation and configuration' },
                { name: 'Data Recovery', price: '₹1750/hr', icon: 'fa-database', description: 'Recovery of lost or corrupted data' },
                { name: 'Virus Removal', price: '₹1200/hr', icon: 'fa-shield-virus', description: 'Removal of viruses and malware' },
                { name: 'Software Installation', price: '₹1350/hr', icon: 'fa-download', description: 'Software installation and setup' },
                { name: 'Smart Home Setup', price: '₹1800/hr', icon: 'fa-home', description: 'Smart home device installation and configuration' },
                { name: 'Tech Training', price: '₹1550/hr', icon: 'fa-chalkboard-teacher', description: 'Personalized technology training sessions' }
            ],
            'Home Services': [
                { name: 'House Cleaning', defaultPrice: 35 },
                { name: 'Plumbing', defaultPrice: 65 },
                { name: 'Electrical Work', defaultPrice: 70 },
                { name: 'Painting', defaultPrice: 45 },
                { name: 'Carpentry', defaultPrice: 60 },
                { name: 'Garden Maintenance', defaultPrice: 40 },
                { name: 'Pest Control', defaultPrice: 80 },
                { name: 'Interior Design', defaultPrice: 85 },
                { name: 'Moving Services', defaultPrice: 75 }
            ],
            'Education': [
                { name: 'Math Tutoring', defaultPrice: 40 },
                { name: 'Science Tutoring', defaultPrice: 45 },
                { name: 'Language Classes', defaultPrice: 35 },
                { name: 'Test Preparation', defaultPrice: 50 },
                { name: 'Music Lessons', defaultPrice: 45 },
                { name: 'Art Classes', defaultPrice: 40 },
                { name: 'Coding Classes', defaultPrice: 55 },
                { name: 'Business Tutoring', defaultPrice: 60 },
                { name: 'Writing Help', defaultPrice: 40 }
            ],
            'Body & Hair Care': [
                { name: 'Haircut & Styling', defaultPrice: 45 },
                { name: 'Hair Coloring', defaultPrice: 85 },
                { name: 'Massage Therapy', defaultPrice: 70 },
                { name: 'Facial Treatment', defaultPrice: 65 },
                { name: 'Manicure', defaultPrice: 35 },
                { name: 'Pedicure', defaultPrice: 40 },
                { name: 'Waxing', defaultPrice: 30 },
                { name: 'Hair Treatment', defaultPrice: 75 },
                { name: 'Makeup Service', defaultPrice: 55 }
            ]
        };

        // Modal functions
        function openServiceModal() {
            document.getElementById('serviceModal').style.display = 'block';
        }

        function closeServiceModal() {
            document.getElementById('serviceModal').style.display = 'none';
        }

        // Update service options based on selected category
        function updateServiceOptions() {
            const category = document.getElementById('serviceCategory').value;
            const serviceTypeSelect = document.getElementById('serviceType');
            const services = serviceCategories[category] || [];

            serviceTypeSelect.innerHTML = '<option value="">Select Service Type</option>';
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.name;
                option.textContent = `${service.name} (Suggested: ${service.price})`;
                serviceTypeSelect.appendChild(option);
            });
        }

        // Handle adding new service
        function handleAddService(event) {
            event.preventDefault();
            
            const category = document.getElementById('serviceCategory').value;
            const serviceType = document.getElementById('serviceType').value;
            const price = document.getElementById('servicePrice').value;
            const description = document.getElementById('serviceDescription').value;

            // Get existing services from localStorage or initialize empty array
            let professionalServices = JSON.parse(localStorage.getItem('professionalServices')) || [];
            
            // Add new service
            const newService = {
                id: Date.now(), // Unique ID for the service
                professionalId: localStorage.getItem('professionalId'),
                professionalName: localStorage.getItem('userName'),
                category,
                serviceType,
                price: formatIndianPrice(price),
                description,
                rating: 0,
                reviews: 0,
                location: 'Mumbai', // You can make this dynamic based on professional's profile
            };

            professionalServices.push(newService);
            localStorage.setItem('professionalServices', JSON.stringify(professionalServices));

            // Create new service item in UI
            const serviceItem = document.createElement('div');
            serviceItem.className = 'service-item';
            serviceItem.innerHTML = `
                <div class="service-header">
                    <div>
                        <span class="service-category">${category}</span>
                        <h3>${serviceType}</h3>
                    </div>
                    <div class="service-controls">
                        <label class="availability-toggle">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                        <button class="edit-btn" onclick="editService(this, ${newService.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete-btn" onclick="deleteService(this, ${newService.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <p>${description}</p>
                <p class="service-price">${newService.price}/hr</p>
            `;

            document.querySelector('.services-list').appendChild(serviceItem);
            closeServiceModal();
            event.target.reset();
        }

        // Edit service
        function editService(button, serviceId) {
            const serviceItem = button.closest('.service-item');
            // Implement edit functionality
        }

        // Delete service
        function deleteService(button, serviceId) {
            if (confirm('Are you sure you want to delete this service?')) {
                let professionalServices = JSON.parse(localStorage.getItem('professionalServices')) || [];
                professionalServices = professionalServices.filter(service => service.id !== serviceId);
                localStorage.setItem('professionalServices', JSON.stringify(professionalServices));
                button.closest('.service-item').remove();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('serviceModal');
            if (event.target === modal) {
                closeServiceModal();
            }
        }

        // Add this currency formatting function
        function formatIndianPrice(amount) {
            // Convert to Indian format (2 decimal places, comma separators)
            const price = Number(amount).toFixed(2);
            const [wholePart, decimalPart] = price.split('.');
            const lastThree = wholePart.substring(wholePart.length - 3);
            const otherNumbers = wholePart.substring(0, wholePart.length - 3);
            const formattedWholePart = otherNumbers !== '' ? otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + "," + lastThree : lastThree;
            return `₹${formattedWholePart}.${decimalPart}`;
        }

        // Add a function to update earnings display
        function updateEarningsDisplay(amount) {
            const formattedAmount = formatIndianPrice(amount);
            document.querySelector('.earnings-dashboard p').textContent = formattedAmount;
            document.querySelector('.stat:first-child p').textContent = formattedAmount;
        }

        // Add a function to add new transaction
        function addTransaction(amount, date, status) {
            const transactionHistory = document.querySelector('.transaction-history');
            const transactionItem = document.createElement('div');
            transactionItem.className = 'transaction-item';
            transactionItem.innerHTML = `
                <p><i class="fas fa-calendar"></i> ${date}</p>
                <p><i class="fas fa-rupee-sign"></i> ${formatIndianPrice(amount)}</p>
                <p class="transaction-status status-${status.toLowerCase()}">${status}</p>
            `;
            transactionHistory.appendChild(transactionItem);
        }

        // Update the booking display function
        function displayBookings() {
            const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const professionalId = localStorage.getItem('professionalId');
            const upcomingBookings = bookings.filter(booking => 
                booking.professionalId === professionalId && 
                ['Pending', 'Accepted', 'In Progress'].includes(booking.status)
            );

            const upcomingBookingsContainer = document.querySelector('.upcoming-bookings');
            if (!upcomingBookingsContainer) return;

            upcomingBookingsContainer.innerHTML = `
                <h3>Upcoming Bookings</h3>
                ${upcomingBookings.length === 0 ? '<p>No upcoming bookings</p>' : 
                    upcomingBookings.map(booking => `
                        <div class="booking-item" data-booking-id="${booking.id}">
                            <div class="booking-info">
                                <div class="client-info">
                                    <i class="fas fa-user-circle"></i>
                                    <p>Client: ${booking.userName || 'Anonymous'}</p>
                                </div>
                                <div class="booking-details">
                                    <p><i class="fas fa-briefcase"></i> Service: ${booking.service}</p>
                                    <p><i class="fas fa-calendar"></i> Date: ${booking.date}</p>
                                    <p><i class="fas fa-clock"></i> Time: ${booking.time}</p>
                                    <p><i class="fas fa-map-marker-alt"></i> Location: ${booking.location.address}</p>
                                </div>
                                <div class="map-view" id="map-${booking.id}" style="height: 200px; width: 100%; border-radius: 8px; margin: 10px 0;"></div>
                                <div class="booking-actions">
                                    ${booking.status === 'Pending' ? `
                                        <button class="action-btn accept" onclick="updateBookingStatus('${booking.id}', 'Accepted')">Accept</button>
                                        <button class="action-btn reject" onclick="updateBookingStatus('${booking.id}', 'Rejected')">Reject</button>
                                    ` : booking.status === 'Accepted' ? `
                                        <button class="action-btn progress" onclick="updateBookingStatus('${booking.id}', 'In Progress')">Start Service</button>
                                    ` : booking.status === 'In Progress' ? `
                                        <button class="action-btn complete" onclick="updateBookingStatus('${booking.id}', 'Completed')">Complete Service</button>
                                    ` : ''}
                                </div>
                                <div class="booking-status ${booking.status.toLowerCase()}">${booking.status}</div>
                                <div class="booking-details">
                                    <p><i class="fas fa-calendar"></i> Date: ${booking.date}</p>
                                    <p><i class="fas fa-clock"></i> Time: ${booking.time}</p>
                                    <p><i class="fas fa-rupee-sign"></i> Amount: ${booking.price}</p>
                                    <p><i class="fas fa-info-circle"></i> Status: 
                                        <span class="status-badge ${booking.status.toLowerCase()}">${booking.status}</span>
                                    </p>
                                    <p><i class="fas fa-map-marker-alt"></i> Location: ${booking.location.address}</p>
                                </div>
                            </div>
                            <div class="booking-actions">
                                ${getActionButtons(booking.status, booking.id)}
                            </div>
                            ${booking.statusHistory ? `
                                <div class="status-history">
                                    <h4>Status History</h4>
                                    ${booking.statusHistory.map(history => `
                                        <div class="status-item">
                                            <span class="status-badge ${history.status.toLowerCase()}">${history.status}</span>
                                            <span class="status-time">${new Date(history.timestamp).toLocaleString()}</span>
                                            <p class="status-note">${history.note}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
            `;
        }

        function getActionButtons(status, bookingId) {
            switch(status) {
                case 'Pending':
                    return `
                        <button class="accept-btn" onclick="updateBookingStatus(${bookingId}, 'Accepted', 'Booking accepted by professional')">
                            <i class="fas fa-check"></i> Accept
                        </button>
                        <button class="reject-btn" onclick="updateBookingStatus(${bookingId}, 'Rejected', 'Booking rejected by professional')">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    `;
                case 'Accepted':
                    return `
                        <button class="start-btn" onclick="updateBookingStatus(${bookingId}, 'In Progress', 'Service started')">
                            <i class="fas fa-play"></i> Start Service
                        </button>
                        <button class="cancel-btn" onclick="updateBookingStatus(${bookingId}, 'Cancelled', 'Booking cancelled by professional')">
                            <i class="fas fa-ban"></i> Cancel
                        </button>
                    `;
                case 'In Progress':
                    return `
                        <button class="complete-btn" onclick="updateBookingStatus(${bookingId}, 'Completed', 'Service completed successfully')">
                            <i class="fas fa-flag-checkered"></i> Complete
                        </button>
                    `;
                default:
                    return '';
            }
        }

        function updateBookingStatus(bookingId, newStatus, note) {
            let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const bookingIndex = bookings.findIndex(b => b.id === bookingId);
            
            if (bookingIndex !== -1) {
                bookings[bookingIndex] = {
                    ...bookings[bookingIndex],
                    status: newStatus,
                    statusHistory: [
                        ...bookings[bookingIndex].statusHistory,
                        {
                            status: newStatus,
                            timestamp: new Date().toISOString(),
                            note: note
                        }
                    ]
                };
                
                localStorage.setItem('bookings', JSON.stringify(bookings));
                displayBookings();
                showStatusUpdateNotification(newStatus);
            }
        }

        function showStatusUpdateNotification(status) {
            const notification = document.createElement('div');
            notification.className = 'status-notification';
            notification.innerHTML = `
                <i class="fas fa-info-circle"></i>
                <span>Booking status updated to: ${status}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize section visibility
            const sections = {
                'services': document.querySelector('.my-services'),
                'bookings': document.querySelector('.bookings'),
                'earnings': document.querySelector('.earnings'),
                'reviews': document.querySelector('.reviews')
            };

            // Hide all sections except the first one
            Object.values(sections).forEach(section => {
                if (section) section.style.display = 'none';
            });
            sections.services.style.display = 'block';

            // Add click handlers to nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const href = e.target.getAttribute('href');
                    if (!href) return;
                    
                    const section = href.replace('#', '');
                    
                    if (section === 'home') {
                        window.location.href = 'index.html';
                        return;
                    }

                    if (sections[section]) {
                        Object.values(sections).forEach(s => {
                            if (s) s.style.display = 'none';
                        });
                        sections[section].style.display = 'block';
                        
                        document.querySelectorAll('.nav-links a').forEach(a => {
                            a.classList.remove('active');
                        });
                        e.target.classList.add('active');

                        if (section === 'bookings') {
                            displayBookings();
                        }
                    }
                });
            });

            // Profile button functionality
            const profileBtn = document.getElementById('profileBtn');
            if (profileBtn) {
                profileBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Show profile modal or dropdown
                    showProfileModal();
                });
            }

            // Initialize notifications
            initializeNotifications();
        });

        // Profile modal
        function showProfileModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content profile-modal">
                    <span class="close-modal">&times;</span>
                    <h2>Professional Profile</h2>
                    <div class="profile-info">
                        <img src="https://randomuser.me/api/portraits/men/44.jpg" alt="Profile" class="profile-image">
                        <h3>${localStorage.getItem('userName') || 'Professional User'}</h3>
                        <p>Professional ID: ${localStorage.getItem('professionalId') || 'N/A'}</p>
                        <div class="profile-stats">
                            <div class="stat">
                                <i class="fas fa-star"></i>
                                <span>4.8</span>
                                <p>Rating</p>
                            </div>
                            <div class="stat">
                                <i class="fas fa-briefcase"></i>
                                <span>156</span>
                                <p>Jobs</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="editProfile()" class="edit-profile-btn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            `;

            document.body.appendChild(modal);
            
            // Close modal functionality
            modal.querySelector('.close-modal').onclick = () => modal.remove();
            window.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

        // Initialize notifications
        function initializeNotifications() {
            // Check for new bookings periodically
            setInterval(() => {
                const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
                const professionalId = localStorage.getItem('professionalId');
                const newBookings = bookings.filter(b => 
                    b.professionalId === professionalId && 
                    b.status === 'Pending' &&
                    !b.notified
                );

                if (newBookings.length > 0) {
                    showNotification(`You have ${newBookings.length} new booking(s)!`);
                    // Mark as notified
                    bookings.forEach(b => {
                        if (newBookings.find(nb => nb.id === b.id)) {
                            b.notified = true;
                        }
                    });
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                }
            }, 30000); // Check every 30 seconds
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-bell"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
</body>
</html>